<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Redis - 三种特殊数据类型 | OddFar&#39;s Notes</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="/notes/img/favicon.ico">
    <meta name="description" content="我们在黑暗中并肩前行，走在各自的朝圣路上!">
    <meta name="keywords" content="oddfar,zhiyuan">
    <meta name="theme-color" content="#11a8cd">
    
    <link rel="preload" href="/notes/assets/css/0.styles.ff73aef4.css" as="style"><link rel="preload" href="/notes/assets/js/app.3d82a0e4.js" as="script"><link rel="preload" href="/notes/assets/js/2.a03d5fb8.js" as="script"><link rel="preload" href="/notes/assets/js/66.2c1a7678.js" as="script"><link rel="prefetch" href="/notes/assets/js/10.da2324b2.js"><link rel="prefetch" href="/notes/assets/js/100.9b487b48.js"><link rel="prefetch" href="/notes/assets/js/101.93e14311.js"><link rel="prefetch" href="/notes/assets/js/102.ce036e4d.js"><link rel="prefetch" href="/notes/assets/js/103.8d04311f.js"><link rel="prefetch" href="/notes/assets/js/104.e003b6d7.js"><link rel="prefetch" href="/notes/assets/js/105.92e48aa9.js"><link rel="prefetch" href="/notes/assets/js/106.4b44acf7.js"><link rel="prefetch" href="/notes/assets/js/107.073837e1.js"><link rel="prefetch" href="/notes/assets/js/108.7d7713cc.js"><link rel="prefetch" href="/notes/assets/js/109.01c1bfd2.js"><link rel="prefetch" href="/notes/assets/js/11.a904090f.js"><link rel="prefetch" href="/notes/assets/js/110.672dd327.js"><link rel="prefetch" href="/notes/assets/js/111.19b3347b.js"><link rel="prefetch" href="/notes/assets/js/112.f52bafd0.js"><link rel="prefetch" href="/notes/assets/js/113.5d17f880.js"><link rel="prefetch" href="/notes/assets/js/114.c108e678.js"><link rel="prefetch" href="/notes/assets/js/115.1bfec39c.js"><link rel="prefetch" href="/notes/assets/js/116.2d855275.js"><link rel="prefetch" href="/notes/assets/js/117.2c67c5fa.js"><link rel="prefetch" href="/notes/assets/js/118.afc0d8c8.js"><link rel="prefetch" href="/notes/assets/js/119.300fa8ce.js"><link rel="prefetch" href="/notes/assets/js/12.6231b878.js"><link rel="prefetch" href="/notes/assets/js/120.f9c17131.js"><link rel="prefetch" href="/notes/assets/js/121.03d9bfe6.js"><link rel="prefetch" href="/notes/assets/js/122.410971ee.js"><link rel="prefetch" href="/notes/assets/js/123.912fd18a.js"><link rel="prefetch" href="/notes/assets/js/124.dc2e1dfe.js"><link rel="prefetch" href="/notes/assets/js/125.98e05cb1.js"><link rel="prefetch" href="/notes/assets/js/126.50a5d945.js"><link rel="prefetch" href="/notes/assets/js/127.1d7bdc15.js"><link rel="prefetch" href="/notes/assets/js/128.751fa233.js"><link rel="prefetch" href="/notes/assets/js/129.918dd517.js"><link rel="prefetch" href="/notes/assets/js/13.290410b4.js"><link rel="prefetch" href="/notes/assets/js/130.a53ea016.js"><link rel="prefetch" href="/notes/assets/js/131.35f81696.js"><link rel="prefetch" href="/notes/assets/js/132.6d01a7a8.js"><link rel="prefetch" href="/notes/assets/js/133.c53f3cd8.js"><link rel="prefetch" href="/notes/assets/js/134.9ad79b6b.js"><link rel="prefetch" href="/notes/assets/js/135.6cb57ea3.js"><link rel="prefetch" href="/notes/assets/js/136.6f9c3d89.js"><link rel="prefetch" href="/notes/assets/js/137.51dbd9b6.js"><link rel="prefetch" href="/notes/assets/js/14.f58ba06d.js"><link rel="prefetch" href="/notes/assets/js/15.658847c0.js"><link rel="prefetch" href="/notes/assets/js/16.5af23d87.js"><link rel="prefetch" href="/notes/assets/js/17.f6944661.js"><link rel="prefetch" href="/notes/assets/js/18.a124452b.js"><link rel="prefetch" href="/notes/assets/js/19.1ccfb775.js"><link rel="prefetch" href="/notes/assets/js/20.42f84f7b.js"><link rel="prefetch" href="/notes/assets/js/21.1557c619.js"><link rel="prefetch" href="/notes/assets/js/22.f55483b2.js"><link rel="prefetch" href="/notes/assets/js/23.dec1c125.js"><link rel="prefetch" href="/notes/assets/js/24.2b0bad20.js"><link rel="prefetch" href="/notes/assets/js/25.08d79373.js"><link rel="prefetch" href="/notes/assets/js/26.f00abbd8.js"><link rel="prefetch" href="/notes/assets/js/27.c2236162.js"><link rel="prefetch" href="/notes/assets/js/28.b44aa2ba.js"><link rel="prefetch" href="/notes/assets/js/29.318bfde1.js"><link rel="prefetch" href="/notes/assets/js/3.dc1252cf.js"><link rel="prefetch" href="/notes/assets/js/30.980e2ad5.js"><link rel="prefetch" href="/notes/assets/js/31.e53913ee.js"><link rel="prefetch" href="/notes/assets/js/32.482d8137.js"><link rel="prefetch" href="/notes/assets/js/33.5246a3a3.js"><link rel="prefetch" href="/notes/assets/js/34.4e26df87.js"><link rel="prefetch" href="/notes/assets/js/35.451440fd.js"><link rel="prefetch" href="/notes/assets/js/36.6b4b0faa.js"><link rel="prefetch" href="/notes/assets/js/37.aa43f5d0.js"><link rel="prefetch" href="/notes/assets/js/38.83e420a3.js"><link rel="prefetch" href="/notes/assets/js/39.1402bf4d.js"><link rel="prefetch" href="/notes/assets/js/4.beb65dcd.js"><link rel="prefetch" href="/notes/assets/js/40.b5149eec.js"><link rel="prefetch" href="/notes/assets/js/41.5d76d461.js"><link rel="prefetch" href="/notes/assets/js/42.5c1fea68.js"><link rel="prefetch" href="/notes/assets/js/43.cd3d37d9.js"><link rel="prefetch" href="/notes/assets/js/44.7956f009.js"><link rel="prefetch" href="/notes/assets/js/45.83f00dcc.js"><link rel="prefetch" href="/notes/assets/js/46.3e31360c.js"><link rel="prefetch" href="/notes/assets/js/47.03bb8ecc.js"><link rel="prefetch" href="/notes/assets/js/48.a08a026b.js"><link rel="prefetch" href="/notes/assets/js/49.f34315a7.js"><link rel="prefetch" href="/notes/assets/js/5.9a68a45b.js"><link rel="prefetch" href="/notes/assets/js/50.7cb36a9d.js"><link rel="prefetch" href="/notes/assets/js/51.1c46065a.js"><link rel="prefetch" href="/notes/assets/js/52.12d485a4.js"><link rel="prefetch" href="/notes/assets/js/53.e0d02609.js"><link rel="prefetch" href="/notes/assets/js/54.b511100e.js"><link rel="prefetch" href="/notes/assets/js/55.90e89b4c.js"><link rel="prefetch" href="/notes/assets/js/56.2bfd45c5.js"><link rel="prefetch" href="/notes/assets/js/57.079b754a.js"><link rel="prefetch" href="/notes/assets/js/58.26f9f151.js"><link rel="prefetch" href="/notes/assets/js/59.15991f96.js"><link rel="prefetch" href="/notes/assets/js/6.8336ef45.js"><link rel="prefetch" href="/notes/assets/js/60.40af505d.js"><link rel="prefetch" href="/notes/assets/js/61.cbbe0420.js"><link rel="prefetch" href="/notes/assets/js/62.66083d80.js"><link rel="prefetch" href="/notes/assets/js/63.cd5894d7.js"><link rel="prefetch" href="/notes/assets/js/64.31604fa6.js"><link rel="prefetch" href="/notes/assets/js/65.a3537f53.js"><link rel="prefetch" href="/notes/assets/js/67.12c1883f.js"><link rel="prefetch" href="/notes/assets/js/68.28827881.js"><link rel="prefetch" href="/notes/assets/js/69.e18984a5.js"><link rel="prefetch" href="/notes/assets/js/7.b10ecb87.js"><link rel="prefetch" href="/notes/assets/js/70.91ba594e.js"><link rel="prefetch" href="/notes/assets/js/71.376c79f3.js"><link rel="prefetch" href="/notes/assets/js/72.8865e74a.js"><link rel="prefetch" href="/notes/assets/js/73.6619f027.js"><link rel="prefetch" href="/notes/assets/js/74.f764926d.js"><link rel="prefetch" href="/notes/assets/js/75.3393cd8d.js"><link rel="prefetch" href="/notes/assets/js/76.8fd5a64f.js"><link rel="prefetch" href="/notes/assets/js/77.8b3e8ac7.js"><link rel="prefetch" href="/notes/assets/js/78.cea5c611.js"><link rel="prefetch" href="/notes/assets/js/79.349f59dd.js"><link rel="prefetch" href="/notes/assets/js/8.7e294b95.js"><link rel="prefetch" href="/notes/assets/js/80.e18365f8.js"><link rel="prefetch" href="/notes/assets/js/81.bcf7a6c4.js"><link rel="prefetch" href="/notes/assets/js/82.e69e83fd.js"><link rel="prefetch" href="/notes/assets/js/83.2b68914c.js"><link rel="prefetch" href="/notes/assets/js/84.ed42b081.js"><link rel="prefetch" href="/notes/assets/js/85.941ec15d.js"><link rel="prefetch" href="/notes/assets/js/86.ad28792e.js"><link rel="prefetch" href="/notes/assets/js/87.9f877ac9.js"><link rel="prefetch" href="/notes/assets/js/88.8088c5ec.js"><link rel="prefetch" href="/notes/assets/js/89.b39431ec.js"><link rel="prefetch" href="/notes/assets/js/9.d2b6aae9.js"><link rel="prefetch" href="/notes/assets/js/90.87af98f8.js"><link rel="prefetch" href="/notes/assets/js/91.de7309e4.js"><link rel="prefetch" href="/notes/assets/js/92.7110f13c.js"><link rel="prefetch" href="/notes/assets/js/93.1ebca7b7.js"><link rel="prefetch" href="/notes/assets/js/94.c45f165c.js"><link rel="prefetch" href="/notes/assets/js/95.b75fed68.js"><link rel="prefetch" href="/notes/assets/js/96.84f7464b.js"><link rel="prefetch" href="/notes/assets/js/97.9fa94801.js"><link rel="prefetch" href="/notes/assets/js/98.1319c278.js"><link rel="prefetch" href="/notes/assets/js/99.0853caf2.js">
    <link rel="stylesheet" href="/notes/assets/css/0.styles.ff73aef4.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/notes/" class="home-link router-link-active"><img src="/notes/img/logo.png" alt="OddFar's Notes" class="logo"> <span class="site-name can-hide">OddFar's Notes</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/notes/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java" class="dropdown-title"><a href="/notes/java/" class="link-title">Java</a> <span class="title" style="display:none;">Java</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Java-Se</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/notes/java/se/initial-java/" class="nav-link">Java基础</a></li><li class="dropdown-subitem"><a href="/notes/java/se/object/" class="nav-link">Java面向对象</a></li><li class="dropdown-subitem"><a href="/notes/java/se/commonly-used-class/" class="nav-link">Java常用类</a></li><li class="dropdown-subitem"><a href="/notes/java/se/collection/synopsis/" class="nav-link">Java集合框架</a></li></ul></li><li class="dropdown-item"><h4>Java-Se进阶</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/notes/java/se/thread/1/" class="nav-link">JUC多线程</a></li></ul></li><li class="dropdown-item"><h4>Java-ee</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/notes/javaweb/" class="nav-link">JavaWeb</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据库" class="dropdown-title"><!----> <span class="title" style="display:;">数据库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>SQL 数据库</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/notes/mysql/" class="nav-link">MySQL</a></li></ul></li><li class="dropdown-item"><h4>NoSQL 数据库</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/notes/redis/" class="nav-link">Redis</a></li><li class="dropdown-subitem"><a href="/notes/es/" class="nav-link">ElasticSearch</a></li><li class="dropdown-subitem"><a href="/notes/mongodb/" class="nav-link">MongoDB</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="框架" class="dropdown-title"><!----> <span class="title" style="display:;">框架</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>数据库</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/notes/mybatis/study-note/" class="nav-link">MyBatis</a></li><li class="dropdown-subitem"><a href="/notes/mybatis-plus/study-note/" class="nav-link">MyBatis-Plus</a></li></ul></li><li class="dropdown-item"><h4>Spring</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/notes/spring/" class="nav-link">Spring</a></li></ul></li><li class="dropdown-item"><h4>中间件</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/notes/rabbitmq/" class="nav-link">RabbitMQ</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="工具|部署" class="dropdown-title"><!----> <span class="title" style="display:;">工具|部署</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/notes/git/" class="nav-link">Git</a></li><li class="dropdown-item"><!----> <a href="/notes/docker/" class="nav-link">Docker</a></li><li class="dropdown-item"><!----> <a href="/notes/jenkins/" class="nav-link">Jenkins</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="项目" class="dropdown-title"><!----> <span class="title" style="display:;">项目</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/notes/campus/" class="nav-link">校园信息墙</a></li></ul></div></div><div class="nav-item"><a href="/notes/about/" class="nav-link">关于</a></div><div class="nav-item"><a href="/notes/archives/" class="nav-link">归档</a></div> <a href="https://github.com/oddfar/notes" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><!----> <nav class="nav-links"><div class="nav-item"><a href="/notes/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java" class="dropdown-title"><a href="/notes/java/" class="link-title">Java</a> <span class="title" style="display:none;">Java</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Java-Se</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/notes/java/se/initial-java/" class="nav-link">Java基础</a></li><li class="dropdown-subitem"><a href="/notes/java/se/object/" class="nav-link">Java面向对象</a></li><li class="dropdown-subitem"><a href="/notes/java/se/commonly-used-class/" class="nav-link">Java常用类</a></li><li class="dropdown-subitem"><a href="/notes/java/se/collection/synopsis/" class="nav-link">Java集合框架</a></li></ul></li><li class="dropdown-item"><h4>Java-Se进阶</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/notes/java/se/thread/1/" class="nav-link">JUC多线程</a></li></ul></li><li class="dropdown-item"><h4>Java-ee</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/notes/javaweb/" class="nav-link">JavaWeb</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据库" class="dropdown-title"><!----> <span class="title" style="display:;">数据库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>SQL 数据库</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/notes/mysql/" class="nav-link">MySQL</a></li></ul></li><li class="dropdown-item"><h4>NoSQL 数据库</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/notes/redis/" class="nav-link">Redis</a></li><li class="dropdown-subitem"><a href="/notes/es/" class="nav-link">ElasticSearch</a></li><li class="dropdown-subitem"><a href="/notes/mongodb/" class="nav-link">MongoDB</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="框架" class="dropdown-title"><!----> <span class="title" style="display:;">框架</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>数据库</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/notes/mybatis/study-note/" class="nav-link">MyBatis</a></li><li class="dropdown-subitem"><a href="/notes/mybatis-plus/study-note/" class="nav-link">MyBatis-Plus</a></li></ul></li><li class="dropdown-item"><h4>Spring</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/notes/spring/" class="nav-link">Spring</a></li></ul></li><li class="dropdown-item"><h4>中间件</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/notes/rabbitmq/" class="nav-link">RabbitMQ</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="工具|部署" class="dropdown-title"><!----> <span class="title" style="display:;">工具|部署</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/notes/git/" class="nav-link">Git</a></li><li class="dropdown-item"><!----> <a href="/notes/docker/" class="nav-link">Docker</a></li><li class="dropdown-item"><!----> <a href="/notes/jenkins/" class="nav-link">Jenkins</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="项目" class="dropdown-title"><!----> <span class="title" style="display:;">项目</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/notes/campus/" class="nav-link">校园信息墙</a></li></ul></div></div><div class="nav-item"><a href="/notes/about/" class="nav-link">关于</a></div><div class="nav-item"><a href="/notes/archives/" class="nav-link">归档</a></div> <a href="https://github.com/oddfar/notes" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>MySQL</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Redis</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/notes/redis/" class="sidebar-link">Redis - 知识体系</a></li><li><a href="/notes/pages/28aa50/" class="sidebar-link">Redis - 概念和基础</a></li><li><a href="/notes/pages/6ea36e/" class="sidebar-link">Redis - 五大数据类型</a></li><li><a href="/notes/pages/5898ab/" aria-current="page" class="active sidebar-link">Redis - 三种特殊数据类型</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/notes/pages/5898ab/#三种特殊数据类型" class="sidebar-link">三种特殊数据类型</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/notes/pages/5898ab/#geo地理位置" class="sidebar-link">GEO地理位置</a></li><li class="sidebar-sub-header"><a href="/notes/pages/5898ab/#hyperloglog" class="sidebar-link">HyperLogLog</a></li><li class="sidebar-sub-header"><a href="/notes/pages/5898ab/#bitmap" class="sidebar-link">BitMap</a></li></ul></li></ul></li><li><a href="/notes/pages/41f31b/" class="sidebar-link">Redis - 事务</a></li><li><a href="/notes/pages/216cfe/" class="sidebar-link">Redis - Java</a></li><li><a href="/notes/pages/feab74/" class="sidebar-link">Redis - 学习笔记-总览</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>ElasticSearch</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>MongoDB</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-0c557b5e><div class="articleInfo" data-v-0c557b5e><ul class="breadcrumbs" data-v-0c557b5e><li data-v-0c557b5e><a href="/notes/" title="首页" class="iconfont icon-home router-link-active" data-v-0c557b5e></a></li> <li data-v-0c557b5e><span data-v-0c557b5e>数据库</span></li><li data-v-0c557b5e><span data-v-0c557b5e>Redis</span></li></ul> <div class="info" data-v-0c557b5e><div title="作者" class="author iconfont icon-touxiang" data-v-0c557b5e><a href="https://oddfar.com/" target="_blank" title="作者" class="beLink" data-v-0c557b5e>zhiyuan</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-0c557b5e><a href="javascript:;" data-v-0c557b5e>2021-05-17</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABGpJREFUSA3tVVtoXFUU3fvOI53UlmCaKIFmwEhsE7QK0ipFEdHEKpXaZGrp15SINsXUWvBDpBgQRKi0+KKoFeJHfZA+ED9KKoIU2gYD9UejTW4rVIzm0VSTziPzuNu1z507dibTTjL4U/DAzLn3nL3X2o91ziX6f9wMFdh6Jvbm9nNSV0msViVO6tN1Rm7NMu2OpeJ9lWBUTDxrJbYTS0hInuwciu9eLHlFxCLCZEk3MegsJmZ5K/JD6t7FkFdEvGUo1g7qJoG3MHImqRIn8/nzY1K9UPKKiJmtnUqHVE3Gbuay6vJE/N2FEmuxFjW2nUuE0yQXRRxLiTUAzs36zhZvOXJPdX850EVnnLZkB8prodQoM5JGj7Xk2mvC7JB8tG04Ef5PiXtG0UtxupRQSfTnBoCy554x18yJHI6I+G5Eru4LHmPJZEQsrvPUbMiA8G/WgMK7w7I+ez7++o2ANfbrjvaOl1tFMs+htG3IrZH9/hDX1Pr8Tc0UvH8tcX29KzAgIGcEkINyW5BF9x891hw6VYqgJHEk0huccS7vh3C6gTiODL+26huuBtbct8eZnqLML8PkxGYpuPZBqtqwkSjgc4mB5gbgig5i+y0UDK35LMxXisn9xQtK+nd26gTIHsHe/oblK/b29fUmN/8Y+9jAQrnBp56m1LcDlDp9irKTExSKduXJVWSqdBMA08pEJnEIOB3FPPMybu/oeV8zFeYN3xx576Q6RH+VmplE4ncQV5v+5rzSoyOU7PuEAg8g803PwBJ0CExno/jcMbN8tONYeOmHiuUNryvm3fRUy4tMPVLdAGkUhNWuggGrJcXPv+ouCjz0MKUHz1J2/E8IC9nqTabcxgaBYM0hPhD5Y65FsbxRQKxCQrDjDctW7PUM3HuZunFyifSAqEfuzCp48Il24luWUWZoyJCaPR82jE0+kFA643wRFVni4RYSq3ohJO2pZ7B5dO4xkDWbEpossJPLSrPjYID8rS2UHTlvyNxqIGsg674XJJ7vnh5L7PNwC4hh2sjCI96mzszOTpxLF0T7l88Yz7lAuK6OnL8gXLOnTvpzSb22YG8W7us3jSebFHeeqnXRG1vt+MoUM84LQIBmMsCTAcOauTh0T0l0neQK7m2bLMt2mGxU3HYssS0J2cdv5wljlPsrIuZLAG/2DOZIXgCYT8uMGZN+e2kSirfxZOPCsC0f24nTZzspnVn9VePS1Z5vubmAGGXG8ZFno9Hel0yfA5ZPhF7Dh972BQJ2qCpgH67lmWtBYbvk6sz02wjky2vXyz0XErP/kFB619js1BtwfOV4OPRqOQBjy3Qbk18vigUPPSD5ceHnwck7W9bhAqZdd7SuG7w4/P2F/GaJh8c7e9qgow+Q7cGBo+98WsLkuktFqiZabtXuQTu/Y5ETbR0v7tNSFnvrmu6pjdoan2KjMu8q/Hmj1EfCO2ZGfEIbIXKUlw8qaX9/b2oeSJmFksSeT/Fn0V3nSypChh4Gjh74ybO9aeZ/AN2dwciu2/MhAAAAAElFTkSuQmCC">Redis - 三种特殊数据类型<!----></h1> <!----> <div class="theme-vdoing-content content__default"><h2 id="三种特殊数据类型"><a href="#三种特殊数据类型" class="header-anchor">#</a> 三种特殊数据类型</h2> <h3 id="geo地理位置"><a href="#geo地理位置" class="header-anchor">#</a> GEO地理位置</h3> <h4 id="简介"><a href="#简介" class="header-anchor">#</a> 简介</h4> <p>Redis 的 GEO 特性在 Redis 3.2 版本中推出， 这个功能可以将用户给定的地理位置信息储存起来， 并对这些信息进行操作。来实现诸如附近位置、摇一摇这类依赖于地理位置信息的功能。geo的数据类型为 zset。</p> <p>GEO 的数据结构总共有六个常用命令：geoadd、geopos、geodist、georadius、 georadiusbymember、gethash</p> <p>官方文档：https://www.redis.net.cn/order/3685.html</p> <h4 id="常用指令"><a href="#常用指令" class="header-anchor">#</a> 常用指令</h4> <p><strong>1、geoadd</strong></p> <p>语法：geoadd key longitude latitude member ...</p> <p>将给定的空间元素(经度、纬度、名字)添加到指定的键里面。
这些数据会以有序集的形式被储存在键里面，从而使得georadius和georadiusbymember这样的
命令可以在之后通过位置查询取得这些元素。
geoadd命令以标准的x,y格式接受参数，所以用户必须先输入经度，然后再输入纬度。
geoadd能够记录的坐标是有限的：非常接近两极的区域无法被索引。
有效的经度介于-180-180度之间，有效的纬度介于-85.05112878 度至 85.05112878 度之间
当用户尝试输入一个超出范围的经度或者纬度时,geoadd命令将返回一个错误。</p> <p>测试：百度搜索经纬度查询，模拟真实数据</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> geoadd china:city <span class="token number">116.23</span> <span class="token number">40.22</span> 北京
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> geoadd china:city <span class="token number">121.48</span> <span class="token number">31.40</span> 上海 <span class="token number">113.88</span> <span class="token number">22.55</span> 深圳 <span class="token number">120.21</span> <span class="token number">30.20</span> 杭州
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">3</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> geoadd china:city <span class="token number">106.54</span> <span class="token number">29.40</span> 重庆 <span class="token number">108.93</span> <span class="token number">34.23</span> 西安 <span class="token number">114.02</span> <span class="token number">30.58</span> 武汉
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">3</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p><strong>2、geopos</strong></p> <p>语法：geopos key member [member...]</p> <p>从key里返回所有给定位置元素的位置（经度和纬度）</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> geopos china:city 北京
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;116.23000055551528931&quot;</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">&quot;40.2200010338739844&quot;</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> geopos china:city 上海 重庆
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;121.48000091314315796&quot;</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">&quot;31.40000025319353938&quot;</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;106.54000014066696167&quot;</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">&quot;29.39999880018641676&quot;</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> geopos china:city 新疆
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>nil<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p><strong>3、geodist</strong></p> <p>语法：geodist key member1 member2 [unit]</p> <p>返回两个给定位置之间的距离，如果两个位置之间的其中一个不存在，那么命令返回空值</p> <p>指定单位的参数unit必须是以下单位的其中一个：</p> <ul><li>m表示单位为米</li> <li>km表示单位为千米</li> <li>mi表示单位为英里</li> <li>ft表示单位为英尺</li></ul> <p>如果用户没有显式地指定单位参数，那么geodist默认使用 米 作为单位。</p> <p>geodist命令在计算距离时会假设地球为完美的球形，在极限情况下，这一假设最大会造成0.5%的误差。</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> geodist china:city 北京 上海
<span class="token string">&quot;1088785.4302&quot;</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> geodist china:city 北京 上海 km
<span class="token string">&quot;1088.7854&quot;</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> geodist china:city 重庆 北京 km
<span class="token string">&quot;1491.6716&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p><strong>4、georadius</strong></p> <p>语法：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>georadius key longitude latitude radius m<span class="token operator">|</span>km<span class="token operator">|</span>ft<span class="token operator">|</span>mi <span class="token punctuation">[</span>withcoord<span class="token punctuation">]</span><span class="token punctuation">[</span>withdist<span class="token punctuation">]</span> <span class="token punctuation">[</span>withhash<span class="token punctuation">]</span><span class="token punctuation">[</span>asc<span class="token operator">|</span>desc<span class="token punctuation">]</span><span class="token punctuation">[</span>count count<span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>以给定的经纬度为中心， 找出某一半径内的元素</p> <p>重新连接 redis-cli，增加参数 --raw ，可以强制输出中文，不然会乱码</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> georadius china:city <span class="token number">100</span> <span class="token number">30</span> <span class="token number">1000</span> km <span class="token comment">#乱码</span>
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;<span class="token entity" title="\xe9">\xe9</span><span class="token entity" title="\x87">\x87</span><span class="token entity" title="\x8d">\x8d</span><span class="token entity" title="\xe5">\xe5</span><span class="token entity" title="\xba">\xba</span><span class="token entity" title="\x86">\x86</span>&quot;</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">&quot;<span class="token entity" title="\xe8">\xe8</span><span class="token entity" title="\xa5">\xa5</span><span class="token entity" title="\xbf">\xbf</span><span class="token entity" title="\xe5">\xe5</span><span class="token entity" title="\xae">\xae</span><span class="token entity" title="\x89">\x89</span>&quot;</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> <span class="token builtin class-name">exit</span>
<span class="token punctuation">[</span>root@localhost bin<span class="token punctuation">]</span><span class="token comment">#  redis-cli --raw -p 6379</span>
<span class="token comment"># 在 china:city 中寻找坐标 100 30 半径为 1000km 的城市</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> georadius china:city <span class="token number">100</span> <span class="token number">30</span> <span class="token number">1000</span> km
重庆
西安

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>withdist 返回位置名称和中心距离</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> georadius china:city <span class="token number">100</span> <span class="token number">30</span> <span class="token number">1000</span> km withdist
重庆
<span class="token number">635.2850</span>
西安
<span class="token number">963.3171</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>withcoord 返回位置名称、经纬度</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> georadius china:city <span class="token number">100</span> <span class="token number">30</span> <span class="token number">1000</span> km withcoord
重庆
<span class="token number">106.54000014066696167</span>
<span class="token number">29.39999880018641676</span>
西安
<span class="token number">108.92999857664108276</span>
<span class="token number">34.23000121926852302</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>withdist withcoord 返回位置名称、距离、经纬度，count 限定寻找个数</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> georadius china:city <span class="token number">100</span> <span class="token number">30</span> <span class="token number">1000</span> km withcoord withdist count <span class="token number">1</span>
重庆
<span class="token number">635.2850</span>
<span class="token number">106.54000014066696167</span>
<span class="token number">29.39999880018641676</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> georadius china:city <span class="token number">100</span> <span class="token number">30</span> <span class="token number">1000</span> km withcoord withdist count <span class="token number">2</span>
重庆
<span class="token number">635.2850</span>
<span class="token number">106.54000014066696167</span>
<span class="token number">29.39999880018641676</span>
西安
<span class="token number">963.3171</span>
<span class="token number">108.92999857664108276</span>
<span class="token number">34.23000121926852302</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p><strong>5、georadiusbymember</strong></p> <p>语法：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>georadiusbymember key member radius m<span class="token operator">|</span>km<span class="token operator">|</span>ft<span class="token operator">|</span>mi <span class="token punctuation">[</span>withcoord<span class="token punctuation">]</span><span class="token punctuation">[</span>withdist<span class="token punctuation">]</span> <span class="token punctuation">[</span>withhash<span class="token punctuation">]</span><span class="token punctuation">[</span>asc<span class="token operator">|</span>desc<span class="token punctuation">]</span><span class="token punctuation">[</span>count count<span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>找出位于指定范围内的元素，中心点是由给定的位置元素决定</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> GEORADIUSBYMEMBER china:city 北京 <span class="token number">1000</span> km
北京
西安
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> GEORADIUSBYMEMBER china:city 上海 <span class="token number">400</span> km
杭州
上海
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p><strong>6、geohash</strong></p> <p>语法：geohash key member [member...]</p> <p>Redis使用geohash将二维经纬度转换为一维字符串，字符串越长表示位置更精确，两个字符串越相似表示距离越近。</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> geohash china:city 北京 重庆
wx4sucu47r0
wm5z22h53v0
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> geohash china:city 北京 上海
wx4sucu47r0
wtw6sk5n300
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p><strong>zrem</strong></p> <p>GEO没有提供删除成员的命令，但是因为GEO的底层实现是zset，所以可以借用zrem命令实现对地理位置信息的删除。</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> geoadd china:city <span class="token number">116.23</span> <span class="token number">40.22</span> beijing
<span class="token number">1</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> zrange china:city <span class="token number">0</span> -1 <span class="token comment"># 查看全部的元素</span>
重庆
西安
深圳
武汉
杭州
上海
beijing
北京
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> zrem china:city beijing <span class="token comment"># 移除元素</span>
<span class="token number">1</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> zrem china:city 北京 <span class="token comment"># 移除元素</span>
<span class="token number">1</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> zrange china:city <span class="token number">0</span> -1
重庆
西安
深圳
武汉
杭州
上海
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><h3 id="hyperloglog"><a href="#hyperloglog" class="header-anchor">#</a> HyperLogLog</h3> <p>Redis 在 2.8.9 版本添加了 HyperLogLog 结构。</p> <p>Redis HyperLogLog 是用来做基数统计的算法，HyperLogLog 的优点是，在输入元素的数量或者体积非常非常大时，计算基数所需的空间总是固定的、并且是很小的。</p> <p>在 Redis 里面，每个 HyperLogLog 键只需要花费 12 KB 内存，就可以计算接近 2^64 个不同元素的基数。这和计算基数时，元素越多耗费内存就越多的集合形成鲜明对比。</p> <p>HyperLogLog则是一种算法，它提供了不精确的去重计数方案。</p> <p>举个栗子：假如我要统计网页的UV（浏览用户数量，一天内同一个用户多次访问只能算一次），传统的解决方案是使用Set来保存用户id，然后统计Set中的元素数量来获取页面UV。但这种方案只能承载少量用户，一旦用户数量大起来就需要消耗大量的空间来存储用户id。我的目的是统计用户数量而不是保存用户，这简直是个吃力不讨好的方案！而使用Redis的HyperLogLog最多需要12k就可以统计大量的用户数，尽管它大概有0.81%的错误率，但对于统计UV这种不需要很精确的数据是可以忽略不计的。</p> <p><strong>什么是基数？</strong></p> <p>比如数据集 {1, 3, 5, 7, 5, 7, 8}， 那么这个数据集的基数集为 {1, 3, 5 ,7, 8}, 基数(不重复元素的数量)为5。</p> <p>基数估计就是在误差可接受的范围内，快速计算基数。</p> <p><strong>基本命令</strong></p> <table><thead><tr><th style="text-align:left;">序号</th> <th style="text-align:left;">命令及描述</th></tr></thead> <tbody><tr><td style="text-align:left;">1</td> <td style="text-align:left;">[PFADD key element <a href="https://www.runoob.com/redis/hyperloglog-pfadd.html" target="_blank" rel="noopener noreferrer">element ...]<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> <br>添加指定元素到 HyperLogLog 中。</td></tr> <tr><td style="text-align:left;">2</td> <td style="text-align:left;">[PFCOUNT key <a href="https://www.runoob.com/redis/hyperloglog-pfcount.html" target="_blank" rel="noopener noreferrer">key ...]<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> <br>返回给定 HyperLogLog 的基数估算值。</td></tr> <tr><td style="text-align:left;">3</td> <td style="text-align:left;">[PFMERGE destkey sourcekey <a href="https://www.runoob.com/redis/hyperloglog-pfmerge.html" target="_blank" rel="noopener noreferrer">sourcekey ...]<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> <br>将多个 HyperLogLog 合并为一个 HyperLogLog，并集计算</td></tr></tbody></table> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> PFADD mykey a b c d e f g h i j
<span class="token number">1</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> PFCOUNT mykey
<span class="token number">10</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> PFADD mykey2 i j z x c <span class="token function">v</span> b n m
<span class="token number">1</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> PFMERGE mykey3 mykey mykey2
OK
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> PFCOUNT mykey3
<span class="token number">15</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h3 id="bitmap"><a href="#bitmap" class="header-anchor">#</a> BitMap</h3> <h4 id="简介-2"><a href="#简介-2" class="header-anchor">#</a> 简介</h4> <p>在开发中，可能会遇到这种情况：需要统计用户的某些信息，如活跃或不活跃，登录或者不登录；又如 需要记录用户一年的打卡情况，打卡了是1， 没有打卡是0，如果使用普通的 key/value存储，则要记录 365条记录，如果用户量很大，需要的空间也会很大，所以 Redis 提供了 Bitmap 位图这中数据结构， Bitmap 就是通过操作二进制位来进行记录，即为 0 和 1；如果要记录 365 天的打卡情况，使用 Bitmap 表示的形式大概如下：0101000111000111...........................，这样有什么好处呢？当然就是节约内存 了，365 天相当于 365 bit，又 1 字节 = 8 bit , 所以相当于使用 46 个字节即可。</p> <p>BitMap 就是通过一个 bit 位来表示某个元素对应的值或者状态, 其中的 key 就是对应元素本身，实际上底层也是通过对字符串的操作来实现。Redis 从 2.2 版本之后新增了setbit, getbit, bitcount 等几个 bitmap 相关命令。</p> <h4 id="操作"><a href="#操作" class="header-anchor">#</a> <strong>操作</strong></h4> <p><strong>1、setbit 设置操作</strong></p> <p>SETBIT key offset value : 设置 key 的第 offset 位为value (1或0)</p> <p>使用 bitmap 来记录上述事例中一周的打卡记录如下所示：</p> <p>周一：1，周二：0，周三：0，周四：1，周五：1，周六：0，周天：0 （1 为打卡，0 为不打卡）</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> setbit sign <span class="token number">0</span> <span class="token number">1</span>
<span class="token number">0</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> setbit sign <span class="token number">1</span> <span class="token number">0</span>
<span class="token number">0</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> setbit sign <span class="token number">2</span> <span class="token number">0</span>
<span class="token number">0</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> setbit sign <span class="token number">3</span> <span class="token number">1</span>
<span class="token number">0</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> setbit sign <span class="token number">4</span> <span class="token number">1</span>
<span class="token number">0</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> setbit sign <span class="token number">5</span> <span class="token number">0</span>
<span class="token number">0</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> setbit sign <span class="token number">6</span> <span class="token number">0</span>
<span class="token number">0</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p><strong>2、getbit 获取操作</strong></p> <p>GETBIT key offset 获取offset设置的值，未设置过默认返回0</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> getbit sign <span class="token number">3</span> <span class="token comment"># 查看周四是否打卡</span>
<span class="token number">1</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> getbit sign <span class="token number">6</span> <span class="token comment"># 查看周七是否打卡</span>
<span class="token number">0</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><strong>3、bitcount 统计操作</strong></p> <p>bitcount key [start, end] 统计 key 上位为1的个数</p> <p>统计这周打卡的记录，可以看到只有3天是打卡的状态：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> bitcount sign
<span class="token number">3</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></div></div> <!----> <div class="page-edit"><div class="edit-link"><a href="https://github.com/oddfar/notes/edit/master/docs/03.数据库/10.Redis/03.三种特殊数据类型.md" target="_blank" rel="noopener noreferrer">在 GitHub 上编辑此页</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----> <div class="last-updated"><span class="prefix">最后更新:</span> <span class="time">2021/09/11, 2:09:00</span></div></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/notes/pages/6ea36e/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">Redis - 五大数据类型</div></a> <a href="/notes/pages/41f31b/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">Redis - 事务</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/notes/pages/6ea36e/" class="prev">Redis - 五大数据类型</a></span> <span class="next"><a href="/notes/pages/41f31b/">Redis - 事务</a>→
      </span></p></div></div></div> <div class="article-list"><div class="article-title"><a href="/notes/archives/" class="iconfont icon-bi">最近更新</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/notes/pages/77221a/"><div>
            项目简介
            <!----></div></a> <span class="date">03-03</span></dt></dl><dl><dd>02</dd> <dt><a href="/notes/pages/5fac1d/"><div>
            项目启动
            <!----></div></a> <span class="date">03-03</span></dt></dl><dl><dd>03</dd> <dt><a href="/notes/pages/ecd5fb/"><div>
            权限控制
            <!----></div></a> <span class="date">03-03</span></dt></dl> <dl><dd></dd> <dt><a href="/notes/archives/" class="more">更多文章&gt;</a></dt></dl></div></div></main></div> <div class="footer"><!----> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2021-2022
    <span>oddfar | <a href="https://note.oddfar.com/sitemap.xml" target="_blank">sitemap.xml</a> | <a href="https://beian.miit.gov.cn/" target="_blank">冀ICP备20001094号</a></span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <!----> <!----> <!----></div><div class="global-ui"></div></div>
    <script src="/notes/assets/js/app.3d82a0e4.js" defer></script><script src="/notes/assets/js/2.a03d5fb8.js" defer></script><script src="/notes/assets/js/66.2c1a7678.js" defer></script>
  </body>
</html>
